<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Program Exerciții cu Timer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 600px;
      margin: auto;
      padding: 20px;
      background: #f9f9f9;
    }
    h1 {
      text-align: center;
    }
    #exerciseText {
      margin: 20px 0;
      white-space: pre-line;
    }
    #timer {
      font-size: 48px;
      text-align: center;
      margin: 10px 0;
    }
    #status {
      font-size: 20px;
      text-align: center;
      margin: 10px 0;
    }
    button {
      margin: 5px;
      padding: 10px 15px;
      font-size: 16px;
    }
    select {
      font-size: 16px;
      padding: 5px;
    }
  </style>
</head>
<body>

<h1>Program Exerciții</h1>

<label for="daySelect">Alege ziua:</label>
<select id="daySelect"></select>

<div id="exerciseText"></div>

<div id="timer">00:00</div>
<div id="status">Așteaptă să începi...</div>

<div style="text-align:center;">
  <button id="startBtn">Start</button>
  <button id="playPauseBtn">Play/Pauză</button>
  <button id="skipBtn">Skip</button>
</div>

<audio id="beepSound" preload="auto">
  <source src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" type="audio/ogg">
</audio>

<script>
  const daySelect = document.getElementById("daySelect");
  const exerciseText = document.getElementById("exerciseText");
  const timerEl = document.getElementById("timer");
  const statusEl = document.getElementById("status");
  const startBtn = document.getElementById("startBtn");
  const playPauseBtn = document.getElementById("playPauseBtn");
  const skipBtn = document.getElementById("skipBtn");
  const beepSound = document.getElementById("beepSound");

  const program = [
    { day: 1, exercise: "Zi libera", duration: 0 },
    { day: 2, exercise: "Plimbare 30 de minute", duration: 30 * 60 },
    { day: 3, exercise: "Plimbare 30 de minute", duration: 30 * 60 },
    { day: 4, exercise: "Plimbare 30 de minute", duration: 30 * 60 },
    { day: 5, exercise: "Zi libera", duration: 0 },
    { day: 6, exercise: "Plimbare 30 de minute", duration: 30 * 60 },
    { day: 7, exercise: "Zi libera", duration: 0 },
    { day: 8, exercise: `Mers rapid 3 min
alergare ușoară 1 min
Mers rapid 3 minute
alergare ușoară 1 min
Mers rapid 3 min
alergare ușoară 1 min
Mers rapid 3 min
alergare ușoară 1 min
Mers rapid 3 min
alergare ușoară 1 min`, duration: 20 * 60 },
    { day: 9, exercise: `Mers rapid 3 min
alergare ușoară 1 min
Mers rapid 3 minute
alergare ușoară 1 min
Mers rapid 3 min
alergare ușoară 1 min
Mers rapid 3 min
alergare ușoară 1 min
Mers rapid 3 min
alergare ușoară 1 min`, duration: 20 * 60 },
    { day: 10, exercise: `Mers rapid 3 min
alergare ușoară 1 min
Mers rapid 3 minute
alergare ușoară 1 min
Mers rapid 3 min
alergare ușoară 1 min
Mers rapid 3 min
alergare ușoară 1 min
Mers rapid 3 min
alergare ușoară 1 min`, duration: 20 * 60 },
    { day: 11, exercise: "Plimbare 30 de minute", duration: 30 * 60 },
    { day: 12, exercise: `Mers rapid 3 min
alergare ușoară 2 min
Mers rapid 3 minute
alergare ușoară 2 min
Mers rapid 3 min
alergare ușoară 2 min
Mers rapid 3 min
alergare ușoară 2 min`, duration: 25 * 60 },
    { day: 13, exercise: `Mers rapid 3 min
alergare ușoară 2 min
Mers rapid 3 minute
alergare ușoară 2 min
Mers rapid 3 min
alergare ușoară 2 min
Mers rapid 3 min
alergare ușoară 2 min`, duration: 25 * 60 },
    { day: 14, exercise: "Zi libera", duration: 0 },
    { day: 15, exercise: `Mers rapid 3 min
alergare ușoară 2 min
Mers rapid 3 minute
alergare ușoară 2 min
Mers rapid 3 min
alergare ușoară 2 min
Mers rapid 3 min
alergare ușoară 3 min
Mers rapid 3 min
alergare ușoară 3 min`, duration: 27 * 60 },
    { day: 16, exercise: `Mers rapid 3 min
alergare ușoară 2 min
Mers rapid 3 minute
alergare ușoară 2 min
Mers rapid 3 min
alergare ușoară 2 min
Mers rapid 3 min
alergare ușoară 2 min
Mers rapid 3 min
alergare ușoară 2 min`, duration: 30 * 60 },
    { day: 17, exercise: "Plimbare 30 de minute", duration: 30 * 60 },
    { day: 18, exercise: `Mers rapid 2 min
alergare ușoară 3 min
Mers rapid 2 min
alergare ușoară 3 min
Mers rapid 2 min
alergare ușoară 3 min
Mers rapid 2 min
alergare ușoară 3 min
Mers rapid 2 min
alergare ușoară 3 min`, duration: 25 * 60 },
    { day: 19, exercise: "Plimbare 30 de minute", duration: 30 * 60 },
    { day: 20, exercise: `Mers rapid 2 min
alergare ușoară 5 min
Mers rapid 2 min
alergare ușoară 5 min
Mers rapid 3 min
alergare ușoară 3 min
Mers rapid 3 min
alergare ușoară 3 min
Mers rapid 3 min
alergare ușoară 3 min`, duration: 32 * 60 },
    { day: 21, exercise: "Zi libera", duration: 0 },
    { day: 22, exercise: `Mers rapid 3 min
alergare ușoară 5 min
Mers rapid 3 min
alergare ușoară 5 min
Mers rapid 4 min
alergare ușoară 10 min`, duration: 30 * 60 },
    { day: 23, exercise: `Mers rapid 3 min
alergare ușoară 10 min
Mers rapid 3 min
alergare ușoară 10 min
Mers rapid 3 min
alergare ușoară 10 min`, duration: 39 * 60 },
    { day: 24, exercise: "Plimbare 30 de minute", duration: 30 * 60 },
    { day: 25, exercise: `Mers rapid 3 min
alergare ușoară 10 min
Mers rapid 3 min
alergare ușoară 10 min
Mers rapid 4 min
alergare ușoară 5 min
Mers rapid 4 min
alergare ușoară 5 min`, duration: 44 * 60 },
    { day: 26, exercise: "Zi libera", duration: 0 },
    { day: 27, exercise: `Mers rapid 5 min
alergare ușoară 5 min
Mers rapid 4 min
alergare ușoară 15 min
Mers rapid 4 min
alergare ușoară 15 min`, duration: 48 * 60 },
    { day: 28, exercise: "Zi libera", duration: 0 },
  ];

  let routineSteps = [], currentStepIndex = 0, stepRemaining = 0;
  let timerInterval = null, isPlaying = false;
  let stepStartTime = null;

  function speak(text) {
    const synth = window.speechSynthesis;
    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = "ro-RO";
    synth.cancel();
    synth.speak(utter);
  }

  function updateTimerDisplay(seconds) {
    const m = Math.floor(seconds / 60);
    const s = seconds % 60;
    timerEl.textContent = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
  }

  function playBeep() {
    beepSound.pause();
    beepSound.currentTime = 0;
    beepSound.play();
  }

  function parseRoutine(text) {
    if (!text || text.toLowerCase().includes("liber")) return [];
    return text.split("\n").map(line => {
      const match = line.match(/(\w+.*?)\s(\d+)/);
      if (match) return { label: match[1], duration: parseInt(match[2]) * 60 };
      return null;
    }).filter(Boolean);
  }

  function startStep() {
    if (routineSteps.length === 0) {
      statusEl.textContent = "Zi liberă. Nu există exerciții.";
      timerEl.textContent = "00:00";
      return;
    }
    const step = routineSteps[currentStepIndex];
    stepRemaining = step.duration;
    stepStartTime = Date.now();
    statusEl.textContent = step.label;
    speak(step.label);
    updateTimerDisplay(stepRemaining);

    if (timerInterval) clearInterval(timerInterval);
    timerInterval = setInterval(() => {
      const elapsed = Math.floor((Date.now() - stepStartTime) / 1000);
      stepRemaining = step.duration - elapsed;
      updateTimerDisplay(stepRemaining);

      if (stepRemaining > 0 && stepRemaining <= 5) playBeep();
      if (stepRemaining <= 0) {
        clearInterval(timerInterval);
        currentStepIndex++;
        if (currentStepIndex < routineSteps.length) {
          startStep();
        } else {
          statusEl.textContent = "Exercițiul s-a terminat!";
          speak("Exercițiul s-a terminat!");
        }
      }
    }, 1000);
  }

  function startTimer() {
    if (!routineSteps.length) {
      statusEl.textContent = "Zi liberă. Nu există exerciții.";
      timerEl.textContent = "00:00";
      return;
    }
    isPlaying = true;
    currentStepIndex = 0;
    startStep();
  }

  function stopTimer() {
    isPlaying = false;
    clearInterval(timerInterval);
    timerEl.textContent = "00:00";
  }

  function populateDays() {
    for (const d of program) {
      const opt = document.createElement("option");
      opt.value = d.day;
      opt.textContent = `Ziua ${d.day}`;
      daySelect.appendChild(opt);
    }
  }

  function loadDay(day) {
    stopTimer();
    const d = program.find(p => p.day == day);
    exerciseText.textContent = d.exercise;
    routineSteps = parseRoutine(d.exercise);
    statusEl.textContent = "Așteaptă să începi...";
  }

  startBtn.onclick = () => {
    if (!isPlaying) startTimer();
  };

  playPauseBtn.onclick = () => {
    isPlaying = !isPlaying;
    statusEl.textContent = isPlaying ? routineSteps[currentStepIndex]?.label || "Continuare..." : "Pauză";
  };

  skipBtn.onclick = () => {
    currentStepIndex++;
    if (currentStepIndex < routineSteps.length) {
      startStep();
    } else {
      statusEl.textContent = "Exercițiul s-a terminat!";
      speak("Exercițiul s-a terminat!");
    }
  };

  daySelect.onchange = () => loadDay(daySelect.value);

  document.addEventListener("DOMContentLoaded", () => {
    populateDays();
    loadDay(1);
    daySelect.value = 1;
  });
</script>

</body>
</html>
